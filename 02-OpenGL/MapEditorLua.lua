--Hardcoded                                   q		     w          e          r          t          y          u          i          o 
--choiceList = {1, 2, 3, 4, 5, 6, 7, 8, 9, 33 = "33", 39 = "39", 21 = "21", 34 = "34", 36 = "36", 41 = "41", 37 = "37", 25 = "25", 31 = "31" } --65 = 65, 71 = 71, 53 = 53, 66 = 66, 68 = 68, 73 = 73, 69 = 69, 57 = 57, 63 = 63
uiObjects = { -1.0, 1.0, 1.0, -1.0, 0, 0, 1, 1, 0,
			  -0.092, -0.832, -0.068, -0.874, 0, 0, 1, 1, 1,
			  -0.060, -0.832, -0.036, -0.874, 0, 0, 1, 1, 2,
			  -0.028, -0.832, -0.004, -0.874, 0, 0, 1, 1, 3,
			  0.004, -0.832, 0.028, -0.874, 0, 0, 1, 1, 4,
			  0.036, -0.832, 0.060, -0.874, 0, 0, 1, 1, 5,
			  0.068, -0.832, 0.092, -0.874, 0, 0, 1, 1, 6,
			  
			  -0.092, -0.888, -0.068, -0.930, 0, 0, 1, 1, 7,
			  -0.060, -0.888, -0.036, -0.930, 0, 0, 1, 1, 8,
			  -0.028, -0.888, -0.004, -0.930,  0, 0, 1, 1, 9,
			  0.004, -0.888, 0.028, -0.930, 0, 0, 1, 1, 10,
			  0.036, -0.888, 0.060, -0.930, 0, 0, 1, 1, 11,
			  0.068, -0.888, 0.092, -0.930, 0, 0, 1, 1, 12,
			  
			  -0.092, -0.944, -0.068, -0.986, 0, 0, 1, 1, 13,
			  -0.060, -0.944, -0.036, -0.986, 0, 0, 1, 1, 14,
			  -0.028, -0.944, -0.004, -0.986, 0, 0, 1, 1, 15,
			  0.004, -0.944, 0.028, -0.986, 0, 0, 1, 1, 16,
			  0.036, -0.944, 0.060, -0.986, 0, 0, 1, 1, 17,
			  0.068, -0.944, 0.092, -0.986, 0, 0, 1, 1, 18,
			  
			  -0.258, -0.832, -0.108, -0.986, 0, 0, 1, 1, 19,
			  0.108, -0.832, 0.258, -0.986, 0, 0, 1, 1, 20,
			  -1.0, 1.0, -0.850, 0.850, 0, 0, 1, 1, 39}
			  
width = {[1] = 30, [2] = 30, [3] = 30, [4] = 30, [5] = 30, [6] = 30, [7] = 30, [8] = 30, [9] = 30, [33] = 30, [39] = 30, [21] = 30, [34] = 30, [36] = 30, [41] = 30, [37] = 30, [25] = 30, [31] = 30}
length = {[1] = 30, [2] = 30, [3] = 30, [4] = 30, [5] = 30, [6] = 30, [7] = 30, [8] = 30, [9] = 30, [33] = 30, [39] = 30, [21] = 30, [34] = 30, [36] = 30, [41] = 30, [37] = 30, [25] = 30, [31] = 30}

textureIndices = {[1] = 21, [2] = 22, [3] = 23, [4] = 24, [5] = 25, [6] = 26, [7] = 27, [8] = 28, [9] = 29, [33] = 30, [39] = 31, [21] = 32, [34] = 33, [36] = 34, [41] = 35, [37] = 36, [25] = 37, [31] = 38}

--loadHelpList = {bana1/eldpelare/eld.obj = 1, bana1/Hus/testhus.obj = 2, bana1/wall/wallrot1.obj = 3, bana1/wall/wallrot2.obj = 4, bana1/arenasittplats/trappafront.obj = 5, bana1/arenasittplats/trappaback.obj = 6, bana1/arenasittplats/trappaleft.obj = 7, bana1/arenasittplats/trapparight.obj = 8, bana2/wc.obj = 9, bana2/wallupp.obj = 33, bana2/wallright.obj = 39, bana2/wallleft.obj = 21, bana2/walldown.obj = 34, bana3/corner.obj = 36, bana3/upwall.obj = 41, bana3/wallright.obj = 37, bana3/wallleft.obj = 25, bana3/walldown.obj = 31 }
loadHelpList = {["bana1/eldpelare/eld.obj"] = 1, ["bana1/Hus/testhus.obj"] = 2, ["bana1/wall/wallrot1.obj"] = 3, ["bana1/wall/wallrot2.obj"] = 4, ["bana1/arenasittplats/trappafront.obj"] = 5, ["bana1/arenasittplats/trappaback.obj"] = 6, ["bana1/arenasittplats/trappaleft.obj"] = 7, ["bana1/arenasittplats/trapparight.obj"] = 8, ["bana2/wc.obj"] = 9, ["bana2/wallupp.obj"] = 33, ["bana2/wallright.obj"] = 39, ["bana2/wallleft.obj"] = 21, ["bana2/walldown.obj"] = 34, ["bana3/corner.obj"] = 36, ["bana3/upwall.obj"] = 41, ["bana3/wallright.obj"] = 37, ["bana3/wallleft.obj"] = 25, ["bana3/walldown.obj"] = 31 }

   --Save information
locationList = {"bana1/eldpelare/eld.obj", "bana1/Hus/testhus.obj", "bana1/wall/wallrot1.obj", "bana1/wall/wallrot2.obj", "bana1/arenasittplats/trappafront.obj", "bana1/arenasittplats/trappaback.obj", "bana1/arenasittplats/trappaleft.obj", "bana1/arenasittplats/trapparight.obj", "bana2/wc.obj", [33] = "bana2/wallupp.obj", [39] = "bana2/wallright.obj", [21] = "bana2/wallleft.obj", [34] = "bana2/walldown.obj", [36] = "bana3/corner.obj", [41] = "bana3/upwall.obj", [37] = "bana3/wallright.obj", [25] = "bana3/wallleft.obj", [31] = "bana3/walldown.obj"}
textureList = {"bana1/eldpelare/eldtexture.png", "bana1/Hus/hustextur1.png", "bana1/wall/wall.png", "bana1/wall/wall.png", "bana1/arenasittplats/trapp.png", "bana1/arenasittplats/trapp.png", "bana1/arenasittplats/trapp.png", "bana1/arenasittplats/trapp.png", "bana2/wc.png", [33] = "bana2/bana2textur.png", [39] = "bana2/bana2textur.png", [21] = "bana2/bana2textur.png", [34] = "bana2/bana2textur.png", [36] = "bana3/uvarena.png", [41] = "bana3/uvarena.png", [37] = "bana3/uvarena.png", [25] = "bana3/uvarena.png", [31] = "bana3/uvarena.png"}

WINDOW_WIDTH = 1280
WINDOW_HEIGHT = 720

--Dynamic
regularObjects = {} --x, z, x2, z2, u, v, u2, v2, texIndex.   Map Editors file format
nrOfrIndices = 0     --regularObjects
rObjectsSaveForm = {} --Games Map format
nrOfIndices = 0      --rObjectsSaveForm

GSFChoices = {}
nrOfGSF = 0

nrOfObjects = 0

function clean()
	for k, v in pairs(regularObjects)
	do
		regularObjects[k] = nil
	end
	for k, v in pairs(rObjectsSaveForm)
	do
		rObjectsSaveForm[k] = nil
	end
	for k, v in pairs(GSFChoices)
	do
		GSFChoices[k] = nil
	end

	nrOfrIndices = 0
	nrOfIndices = 0
	nrOfObjects = 0
	nrOfGSF = 0
end

function mapEditUI()
	return uiObjects
end

function mouseClick(mx , my)
	local tmpTable = {}
	local tmpX = (mx  * 2.0 / WINDOW_WIDTH) - 1.0
	local tmpY = -(my * 2.0 / WINDOW_HEIGHT) + 1.0

	if tmpX < -0.108 and tmpX > -0.258 and tmpY < -0.832 and tmpY > -0.986 then
		loadMap()
		return regularObjects, 3
	elseif tmpX < 0.258 and tmpX > 0.108 and tmpY < -0.832 and tmpY > -0.986 then
		saveMap()
		return 0 
	elseif tmpX < -0.850 and tmpX > -1.0 and tmpY < 1.0 and tmpY > 0.850 then		--Back
		return 2
	else
		return 1
	end
end

function placeObject(mx, my, choice)
	local tempT = {}
	if nrOfObjects < 30 then
		nrOfIndices = nrOfIndices + 1
		rObjectsSaveForm[nrOfIndices] = locationList[choice]
		
		nrOfIndices = nrOfIndices + 1
		rObjectsSaveForm[nrOfIndices] = mx
		
		nrOfIndices = nrOfIndices + 1
		rObjectsSaveForm[nrOfIndices] = 0.0
		
		nrOfIndices = nrOfIndices + 1
		rObjectsSaveForm[nrOfIndices] = my
		
		nrOfIndices = nrOfIndices + 1
		rObjectsSaveForm[nrOfIndices] = textureList[choice]
		
		tempT = calcOutPut(mx, my, choice)
		nrOfObjects = nrOfObjects + 1

		nrOfGSF = nrOfGSF + 1
		GSFChoices[nrOfGSF] = choice

		return tempT, true
	else
		return false
	end
end

function calcOutPut(mx, my, choice)
	--local x, y, x2, y2, u, v, u2, v2, texIndex
	local tempTable = {}

	tempTable[1] = ((mx - (width[choice] / 2.0)) * 2.0 / WINDOW_WIDTH) - 1.0
	tempTable[2] = -((my + (length[choice] / 2.0))* 2.0 / WINDOW_HEIGHT) + 1.0
	tempTable[3] = ((mx + (width[choice] / 2.0)) * 2.0 / WINDOW_WIDTH) - 1.0
	tempTable[4] = -((my - (length[choice] / 2.0))* 2.0 / WINDOW_HEIGHT) + 1.0

	nrOfrIndices = nrOfrIndices + 1
	regularObjects[nrOfrIndices] = tempTable[1]

	
	nrOfrIndices = nrOfrIndices + 1
	regularObjects[nrOfrIndices] = tempTable[2]

	
	nrOfrIndices = nrOfrIndices + 1
	regularObjects[nrOfrIndices] = tempTable[3]

	
	nrOfrIndices = nrOfrIndices + 1
	regularObjects[nrOfrIndices] = tempTable[4]
	
	tempTable[5] = 0
	nrOfrIndices = nrOfrIndices + 1
	regularObjects[nrOfrIndices] = tempTable[5]

	tempTable[6] = 1
	nrOfrIndices = nrOfrIndices + 1
	regularObjects[nrOfrIndices] = tempTable[6]

	tempTable[7] = 1
	nrOfrIndices = nrOfrIndices + 1
	regularObjects[nrOfrIndices] = tempTable[7]

	tempTable[8] = 0
	nrOfrIndices = nrOfrIndices + 1
	regularObjects[nrOfrIndices] = tempTable[8]

	nrOfrIndices = nrOfrIndices + 1
	tempTable[9] = textureIndices[choice]
	regularObjects[nrOfrIndices] = tempTable[9]

	return tempTable
end



function removeObjectsHandler()
	if nrOfObjects == 0 then
		return false
	elseif nrOfObjects == 1 then
		onlyOneLeft()
	else
		removeObject()
	end
	return true
end

function onlyOneLeft()
	for i = 1, 9, 1
	do
		regularObjects[i] = nil
		rObjectsSaveForm[i] = nil
	end
	nrOfPosIndices = 0
	nrOfIndices = 0
	nrOfObjects = 0
end

function removeObject()
	for i = 1, 9
	do
		regularObjects[nrOfrIndices] = nil
		nrOfrIndices = nrOfrIndices - 1

		rObjectsSaveForm[nrOfIndices] = nil
		nrOfIndices = nrOfIndices - 1
	end
	nrOfObjects = nrOfObjects - 1
end


function saveMap()
	local counter = 0
	local GSFCounter = 0

	--regularObjects Map Editors file format
	local file = io.open("MapEditorSaveMEF.dat", "w+")	 --MEF = MAP EDITOR FORMAT
	io.output(file)	

	io.write(nrOfrIndices, "\n");

	while counter < nrOfrIndices
	do
		counter = counter + 1
		io.write(regularObjects[counter], "\n")
	end
	io.close(file)

	counter = 0

	--rObjectsSaveForm Games Map format
	local file = io.open("MapEditorSaveGF.dat", "w+") --GF = GAME FORMAT
	io.output(file)

	io.write(nrOfGSF, "\n");
	--Hardcoded ground
	io.write("plane.obj", "\n");
	io.write(227.5, "\n");
	io.write(0.0, "\n");
	io.write(128.0, "\n");
	io.write("andrabanansand.png", "\n");
	io.write(-1.0, "\n");
	io.write(-1.0, "\n");

	while counter < nrOfIndices
	do
		counter = counter + 1
		io.write(rObjectsSaveForm[counter], "\n")

		if math.fmod(counter, 5) == 0 then
			GSFCounter = GSFCounter + 1
			io.write(width[GSFCounter], "\n")
			io.write(length[GSFCounter], "\n")
		end
	end
	io.close(file)

	GSFCounter = nil
	counter = nil
end

function loadMap()
	local counter = 0
	local GFCounter = 0
	local temp = 0

	clean()

	--regularObjects Map Editors file format
	local file = io.open("MapEditorSaveMEF.dat", "r")
	io.input(file)
	
	nrOfrIndices = tonumber(io.read("*l"))
	
	while counter < nrOfrIndices
	do
		counter = counter + 1
		regularObjects[counter] = io.read("*l")
	end
	io.close(file)
	
	counter = 0


	local file = io.open("MapEditorSaveGF.dat", "r")
	io.input(file)
	nrOfGSF = tonumber(io.read("*l"))
	GFCounter = nrOfGSF * 5
	nrOfIndices = GFCounter
	
	--Removes the ground data
	for i = 1, 7
	do 
		temp = io.read("*l")
	end
	
	while counter < GFCounter
	do
		counter = counter + 1
		rObjectsSaveForm[counter] = io.read("*l")
		if math.fmod(counter, 5) == 0 then
			temp = io.read("*l")
			temp = io.read("*l")
			GSFChoices[counter/5] = loadHelpList[rObjectsSaveForm[counter/5]]
		end
	end
	
	io.close(file)

	counter = nil
	temp = nil
	GFCounter = nil
end
	